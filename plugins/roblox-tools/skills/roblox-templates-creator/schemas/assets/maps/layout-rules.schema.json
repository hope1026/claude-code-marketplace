{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "layout-rules.schema.json",
  "title": "Layout Rules Schema",
  "description": "에셋 배치 규칙 정의 - 데코레이션 에셋의 랜덤 배치 규칙",

  "definitions": {
    "rangeNumber": {
      "type": "object",
      "properties": {
        "min": { "type": "number" },
        "max": { "type": "number" }
      },
      "required": ["min", "max"],
      "additionalProperties": false
    },

    "constraints": {
      "type": "object",
      "description": "배치 제약 조건",
      "properties": {
        "minSpacing": {
          "type": "number",
          "minimum": 0,
          "description": "에셋 간 최소 간격 (studs)"
        },
        "avoidTags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "피해야 할 영역 태그"
        },
        "terrainMaterials": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Grass", "LeafyGrass", "Ground", "Mud", "Sand", "Rock",
              "Slate", "Basalt", "Snow", "Glacier", "Ice", "Water",
              "CrackedLava", "Concrete", "Pavement", "Brick", "Cobblestone"
            ]
          },
          "description": "허용되는 지형 재질"
        },
        "maxSlope": {
          "type": "number",
          "minimum": 0,
          "maximum": 90,
          "default": 45,
          "description": "허용되는 최대 경사도 (degrees)"
        }
      },
      "additionalProperties": false
    },

    "randomization": {
      "type": "object",
      "description": "랜덤화 옵션",
      "properties": {
        "rotation": {
          "$ref": "#/definitions/rangeNumber",
          "description": "Y축 회전 범위 (degrees)"
        },
        "scale": {
          "$ref": "#/definitions/rangeNumber",
          "description": "크기 배율 범위"
        },
        "offset": {
          "$ref": "#/definitions/rangeNumber",
          "description": "위치 오프셋 범위 (studs)"
        }
      },
      "additionalProperties": false
    },

    "layoutRule": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "규칙 고유 ID"
        },
        "decorationSet": {
          "type": "string",
          "description": "decorations.json의 set ID 참조"
        },
        "zones": {
          "type": "array",
          "items": { "type": "string" },
          "description": "적용할 spawnZone ID 목록"
        },
        "density": {
          "$ref": "#/definitions/rangeNumber",
          "description": "배치할 에셋 개수 범위"
        },
        "constraints": {
          "$ref": "#/definitions/constraints"
        },
        "randomization": {
          "$ref": "#/definitions/randomization"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 50,
          "description": "배치 우선순위 (높을수록 먼저 배치)"
        }
      },
      "required": ["id", "decorationSet", "zones", "density"],
      "additionalProperties": false
    }
  },

  "type": "array",
  "items": { "$ref": "#/definitions/layoutRule" },

  "examples": [
    [
      {
        "id": "forest_trees_rule",
        "decorationSet": "forest_trees",
        "zones": ["forest_zone", "hill_zone"],
        "density": { "min": 20, "max": 40 },
        "constraints": {
          "minSpacing": 8,
          "avoidTags": ["path", "spawn", "safe"],
          "terrainMaterials": ["Grass", "Ground", "LeafyGrass"],
          "maxSlope": 30
        },
        "randomization": {
          "rotation": { "min": 0, "max": 360 },
          "scale": { "min": 0.8, "max": 1.2 }
        },
        "priority": 60
      },
      {
        "id": "scattered_rocks_rule",
        "decorationSet": "rocks_small",
        "zones": ["mountain_zone"],
        "density": { "min": 10, "max": 20 },
        "constraints": {
          "minSpacing": 5,
          "terrainMaterials": ["Rock", "Slate", "Ground"]
        },
        "randomization": {
          "rotation": { "min": 0, "max": 360 },
          "scale": { "min": 0.6, "max": 1.4 }
        },
        "priority": 40
      }
    ]
  ]
}
