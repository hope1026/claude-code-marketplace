{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "maps.schema.json",
  "title": "Maps Registry Schema",
  "description": "Schema for maps/maps.json - unified entry point for all game environments",
  "type": "object",
  "required": ["_meta", "sources", "environments", "themes"],
  "properties": {
    "_meta": {
      "type": "object",
      "required": ["description", "lastUpdated", "version"],
      "properties": {
        "description": { "type": "string" },
        "lastUpdated": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "usage": { "type": "string" },
        "schemaRefs": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "placementNotes": {
          "type": "object",
          "description": "Documentation for decoration placement calculation"
        }
      }
    },
    "sources": {
      "type": "object",
      "description": "Relative paths to source JSON files in sources/ folder",
      "additionalProperties": { "type": "string" }
    },
    "environments": {
      "type": "array",
      "description": "All available environments with unique IDs",
      "items": { "$ref": "#/$defs/environment" },
      "minItems": 1
    },
    "themes": {
      "type": "object",
      "description": "Theme-based environment groupings",
      "additionalProperties": { "$ref": "#/$defs/theme" }
    },
    "recommended": {
      "type": "object",
      "description": "Recommended environments for game types",
      "additionalProperties": { "$ref": "#/$defs/recommendedSet" }
    }
  },
  "$defs": {
    "environment": {
      "type": "object",
      "required": ["id", "type", "theme", "name", "source"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^env-(t|m|tm|ts)-\\d{3}$",
          "description": "Unique ID: env-t-XXX (terrain), env-m-XXX (map), env-tm-XXX (terrain+map), env-ts-XXX (terrain+structures)"
        },
        "type": {
          "type": "string",
          "enum": ["terrain_only", "map_only", "terrain_with_map", "terrain_with_decorations"]
        },
        "theme": { "type": "string" },
        "name": { "type": "string" },
        "nameKo": { "type": "string" },
        "description": { "type": "string" },
        "source": {
          "type": "string",
          "description": "Source key matching sources object (e.g., 'terrain-presets', 'standalone-maps')"
        },
        "preset": {
          "type": "string",
          "description": "Terrain preset key (for terrain_only, terrain_with_map, terrain_with_structures)"
        },
        "assetId": {
          "type": "integer",
          "description": "Roblox asset ID (for map_only, terrain_with_map)"
        },
        "mapName": {
          "type": "string",
          "description": "Map name for combo types"
        },
        "decorationSets": {
          "type": "array",
          "description": "Decoration set IDs from decorations.json (for terrain_with_decorations type)",
          "items": { "type": "string" }
        },
        "decorationOffsets": {
          "type": "object",
          "description": "Per-decoration-set Y offset overrides for this environment",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "y": { "type": "number", "description": "Additional Y offset in studs" }
            }
          }
        },
        "difficulty": { "type": "string" },
        "creator": { "type": "string" },
        "cameraSource": {
          "type": "string",
          "enum": ["map", "terrain"],
          "description": "Which source to use for camera config in combo types"
        }
      }
    },
    "theme": {
      "type": "object",
      "required": ["name", "environmentIds"],
      "properties": {
        "name": { "type": "string" },
        "nameKo": { "type": "string" },
        "environmentIds": {
          "type": "array",
          "items": { "type": "string", "pattern": "^env-(t|m|tm|ts)-\\d{3}$" },
          "minItems": 1,
          "description": "Array of environment IDs belonging to this theme"
        }
      }
    },
    "recommendedSet": {
      "type": "object",
      "required": ["description", "environmentIds"],
      "properties": {
        "description": { "type": "string" },
        "environmentIds": {
          "type": "array",
          "items": { "type": "string", "pattern": "^env-(t|m|tm|ts)-\\d{3}$" },
          "description": "Array of recommended environment IDs"
        }
      }
    }
  }
}
